<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoV COMMANDER v6.0 (ULTIMATE)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0f172a; color: #f1f5f9; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        /* Style spécifique scanner */
        .scan-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.5rem; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ==========================================
        // 1. MEGA-BASE DE DONNÉES (Fusion Fichiers 28 & 30)
        // ==========================================

        const RPCS = ["https://wax.greymass.com", "https://api.waxsweden.org", "https://wax.eosn.io", "https://api.wax.alohaeos.com", "https://api-wax.eosarabia.net", "https://wax.bountyblok.io"];
        const INITIAL_PRICES = { WAX: 1, DOVX: 0.005285, DOVR: 0.00045, DOVH: 0.00045, DOVF: 0.00045, DOVS: 0.00045 };

        // --- DONNÉES MANAGER (Fichier 28) ---
        const ZONES_FULL = [
            { id: 1, name: 'Beach 1', type: 'Beach', win: 400, usage: 1160, minWeight: 14, keyReq: 0, officerReq: 1 },
            { id: 2, name: 'Beach 2', type: 'Beach', win: 2405, usage: 6968, minWeight: 28, keyReq: 5, officerReq: 2 },
            { id: 3, name: 'Beach 3', type: 'Beach', win: 3037, usage: 8800, minWeight: 55, keyReq: 6, officerReq: 3 },
            { id: 4, name: 'Bunker', type: 'Beach', win: 3838, usage: 11120, minWeight: 109, keyReq: 7, officerReq: 4, isCheckpoint: true, unitReq: 'e2' }, 
            { id: 5, name: 'Forest 1', type: 'Forest', win: 4840, usage: 14024, minWeight: 219, keyReq: 8, officerReq: 5 },
            { id: 6, name: 'Forest 2', type: 'Forest', win: 6110, usage: 17704, minWeight: 342, keyReq: 9, officerReq: 6 },
            { id: 7, name: 'Forest 3', type: 'Forest', win: 7714, usage: 22352, minWeight: 450, keyReq: 10, officerReq: 7 },
            { id: 8, name: 'Camp', type: 'Forest', win: 9739, usage: 28220, minWeight: 512, keyReq: 11, officerReq: 8, isCheckpoint: true, unitReq: 'e1' },
            { id: 9, name: 'Hill 1', type: 'Hill', win: 12788, usage: 37052, minWeight: 695, keyReq: 12, officerReq: 9 },
            { id: 10, name: 'Hill 2', type: 'Hill', win: 16791, usage: 48652, minWeight: 869, keyReq: 13, officerReq: 10 },
            { id: 11, name: 'Hill 3', type: 'Hill', win: 22266, usage: 64516, minWeight: 1086, keyReq: 14, officerReq: 11 },
            { id: 12, name: 'Radar', type: 'Hill', win: 29236, usage: 84712, minWeight: 1358, keyReq: 15, officerReq: 12, isCheckpoint: true, unitReq: 'e3', godmotherReq: true },
            { id: 13, name: 'Plain 1', type: 'Plain', win: 34300, usage: 99384, minWeight: 1697, keyReq: 16, officerReq: 13 },
            { id: 14, name: 'Plain 2', type: 'Plain', win: 43385, usage: 125708, minWeight: 1866, keyReq: 17, officerReq: 14 },
            { id: 15, name: 'Plain 3', type: 'Plain', win: 52171, usage: 151164, minWeight: 2052, keyReq: 18, officerReq: 15 },
            { id: 16, name: 'HQ', type: 'Plain', win: 64884, usage: 188000, minWeight: 2495, keyReq: 19, officerReq: 16, isCheckpoint: true, unitReq: 'l1', godmotherReq: true },
            { id: 17, name: 'City 1', type: 'City', win: 0, usage: 0, entryCostDovX: 777.35, minWeight: 108.53, keyReq: 9, officerReq: 1 },
            { id: 18, name: 'City 2', type: 'City', win: 0, usage: 0, entryCostDovX: 2213.87, minWeight: 511.76, keyReq: 13, officerReq: 1 },
            { id: 19, name: 'City 3', type: 'City', win: 0, usage: 0, entryCostDovX: 6677.85, minWeight: 1357.04, keyReq: 17, officerReq: 1 },
            { id: 20, name: 'City 4', type: 'City', win: 0, usage: 0, entryCostDovX: 14850.80, minWeight: 2494.23, keyReq: 20, officerReq: 1 } 
        ];

        const generateFactories = () => {
            const types = ['FUEL', 'REPAIR', 'SUPPLY', 'HEALTH'];
            const rarities = [
                { name: 'Common', levels: [ { l: 1, out: 5.40, cost: 0.4590 }, { l: 2, out: 12.15, cost: 1.0328 }, { l: 3, out: 30.38, cost: 2.5819 }, { l: 4, out: 83.53, cost: 7.1002 }, { l: 5, out: 1458.00, cost: 123.9300 } ]},
                { name: 'Rare', levels: [ { l: 1, out: 16.20, cost: 1.3770 }, { l: 2, out: 36.45, cost: 3.0983 }, { l: 3, out: 91.13, cost: 7.7456 }, { l: 4, out: 250.59, cost: 21.3005 } ]},
                { name: 'Epic', levels: [ { l: 1, out: 48.60, cost: 4.1310 }, { l: 2, out: 109.35, cost: 9.2948 }, { l: 3, out: 273.38, cost: 23.2369 }, { l: 4, out: 751.78, cost: 63.9014 } ]},
                { name: 'Legendary', levels: [ { l: 1, out: 145.80, cost: 12.3930 }, { l: 2, out: 328.05, cost: 27.8843 }, { l: 3, out: 820.13, cost: 69.7106 }, { l: 4, out: 2255.34, cost: 191.7042 } ]}
            ];
            let list = [];
            types.forEach(type => { rarities.forEach(rarity => { rarity.levels.forEach(level => {
                list.push({ id: `${rarity.name.charAt(0)}_${type.charAt(0)}${level.l}`, name: `${rarity.name} ${type} ${level.l}`, type: type, rarity: rarity.name, level: level.l, output: level.out, costDoVX: level.cost });
            }); }); });
            return list;
        };
        const FACTORIES = generateFactories();

        // --- ICONS ---
        const Icon = ({p, c="text-current", s=20}) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={c}><path d={p}/></svg>;
        const I = {
            Radar: (p) => <Icon {...p} p="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 6 6 0 1 1-5.32-5.32M22 2l-8.3 8.3M22 2h-4M22 2v4"/>,
            Factory: (p) => <Icon {...p} p="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/>,
            Combat: (p) => <Icon {...p} p="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>,
            Flask: (p) => <Icon {...p} p="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"/>,
            Scale: (p) => <Icon {...p} p="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Zm-14 0 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1ZM7 21h10M12 3v18M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/>
        };

        const Card = ({ children, className = "" }) => <div className={`bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-xl ${className}`}>{children}</div>;

        // ==========================================
        // 2. MODULE : SCANNER LIVE (Le "Moteur" V61)
        // ==========================================
        const LiveScanner = ({ targetUser, onUpdate }) => {
            const [scanning, setScanning] = useState(false);
            const [logs, setLogs] = useState([]);
            const [stats, setStats] = useState({ total: 0, ready: 0, busy: 0, typeF:0, typeH:0, typeR:0, typeS:0 });
            const [localBuildings, setLocalBuildings] = useState([]);

            const log = (msg) => setLogs(prev => [`> ${msg}`, ...prev].slice(0, 6));

            const fetchTable = async (code, table, lower) => {
                let attempts = 0;
                while(attempts < 3) {
                    try {
                        const rpc = RPCS[Math.floor(Math.random() * RPCS.length)];
                        const res = await fetch(`${rpc}/v1/chain/get_table_rows`, {
                            method: 'POST', body: JSON.stringify({ json: true, code, scope: code, table, limit: 1000, lower_bound: lower })
                        });
                        if(res.ok) return await res.json();
                    } catch(e) {}
                    attempts++;
                }
                return { rows: [] };
            };

            const startScan = async () => {
                setScanning(true); setLocalBuildings([]); setLogs([]);
                log(`Scan complet pour ${targetUser}...`);
                
                let allBuildings = [];
                let nextKey = "";
                let hasMore = true;
                let c = { total: 0, ready: 0, busy: 0, F:0, H:0, R:0, S:0 };

                try {
                    while(hasMore) {
                        const data = await fetchTable("dovutilstake", "buildings", nextKey);
                        if(!data.rows || !data.rows.length) break;
                        
                        const batch = data.rows.filter(r => r.owner === targetUser);
                        const now = Date.now()/1000;

                        batch.forEach(b => {
                            c.total++;
                            const isReady = now > (parseFloat(b.last_claim) + parseFloat(b.delay));
                            if(isReady) c.ready++; else c.busy++;
                            
                            const pRaw = Array.isArray(b.power) ? b.power[0] : b.power;
                            if(pRaw.includes("DOVF")) c.F++;
                            else if(pRaw.includes("DOVH")) c.H++;
                            else if(pRaw.includes("DOVR")) c.R++;
                            else if(pRaw.includes("DOVS")) c.S++;

                            allBuildings.push({ ...b, isReady, pRaw });
                        });

                        setStats({...c, typeF:c.F, typeH:c.H, typeR:c.R, typeS:c.S});
                        setLocalBuildings(prev => [...prev, ...batch.map(b => {
                             const now = Date.now()/1000;
                             return { ...b, isReady: now > (parseFloat(b.last_claim) + parseFloat(b.delay)), pRaw: Array.isArray(b.power) ? b.power[0] : b.power };
                        })]);

                        if(data.more && data.next_key !== nextKey) nextKey = data.next_key; else hasMore = false;
                        log(`Chargé ${allBuildings.length} bâtiments...`);
                    }
                    
                    // Scan Divisions
                    const divData = await fetchTable("dovpvecontrl", "sdivisions", targetUser);
                    const divs = divData.rows ? divData.rows.filter(r => r.owner === targetUser || r.user === targetUser) : [];
                    log(`Divisions trouvées : ${divs.length}`);

                    onUpdate(allBuildings, divs);
                    log("Scan terminé avec succès.");

                } catch(e) { log("Erreur: " + e.message); }
                setScanning(false);
            };

            return (
                <div className="space-y-4">
                    <Card className="border-l-4 border-purple-500">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="font-bold text-purple-400 flex items-center gap-2"><I.Radar/> SCANNER LIVE (BLOCKCHAIN)</h3>
                            <button onClick={startScan} disabled={scanning} className={`px-6 py-2 rounded font-bold ${scanning ? 'bg-slate-700' : 'bg-purple-600 hover:bg-purple-500'}`}>
                                {scanning ? 'SCAN EN COURS...' : 'LANCER SCAN'}
                            </button>
                        </div>
                        <div className="grid grid-cols-4 gap-4 text-center mb-4">
                            <div className="bg-slate-900 p-2 rounded"><div className="text-xs text-slate-400">TOTAL</div><div className="text-xl font-bold">{stats.total}</div></div>
                            <div className="bg-slate-900 p-2 rounded border border-emerald-500/30"><div className="text-xs text-emerald-400">PRÊTS</div><div className="text-xl font-bold text-emerald-400">{stats.ready}</div></div>
                            <div className="bg-slate-900 p-2 rounded border border-orange-500/30"><div className="text-xs text-orange-400">ACTIFS</div><div className="text-xl font-bold text-orange-400">{stats.busy}</div></div>
                            <div className="bg-slate-900 p-2 rounded flex flex-col justify-center text-[10px]">
                                <div className="flex justify-between px-2"><span className="text-orange-300">F: {stats.typeF}</span><span className="text-red-300">H: {stats.typeH}</span></div>
                                <div className="flex justify-between px-2"><span className="text-slate-300">R: {stats.typeR}</span><span className="text-yellow-300">S: {stats.typeS}</span></div>
                            </div>
                        </div>
                        {/* LISTE BATIMENTS */}
                        {localBuildings.length > 0 && (
                            <div className="scan-grid max-h-[300px] overflow-y-auto pr-2">
                                {localBuildings.map((b, i) => (
                                    <div key={i} className={`p-2 rounded border text-xs ${b.isReady ? 'bg-emerald-900/20 border-emerald-800' : 'bg-slate-900 border-slate-700'}`}>
                                        <div className="flex justify-between font-bold mb-1"><span>#{b.asset_id}</span><span className={b.isReady?'text-emerald-400':'text-orange-400'}>{b.isReady?'CLAIM':'BUSY'}</span></div>
                                        <div className="text-[10px] text-slate-400">{b.pRaw}</div>
                                    </div>
                                ))}
                            </div>
                        )}
                        <div className="mt-4 bg-black p-2 rounded font-mono text-[10px] text-slate-500 h-20 overflow-y-auto">
                            {logs.map((l, i) => <div key={i}>{l}</div>)}
                        </div>
                    </Card>
                </div>
            );
        };

        // ==========================================
        // 3. MODULE : BLEND SIMULATOR (Fichier 29)
        // ==========================================
        const BlendSim = ({ prices, waxPrice }) => {
            const [zone, setZone] = useState('CITY');
            const [inv, setInv] = useState({ F1:0, F4:0 });
            
            const runSim = () => {
                // Simulation simple basée sur les probs du fichier 29
                let f1 = inv.F1; let f4 = inv.F4;
                for(let i=0; i<100; i++) {
                    const r = Math.random();
                    if(zone === 'CITY') { f1++; } // City ne drop que du F1
                    else { // Bunker drop F4 rare
                        if(r < 0.0008) f4++; else f1++;
                    }
                }
                setInv({F1: f1, F4: f4});
            };

            return (
                <Card className="border-t-4 border-pink-500">
                    <h3 className="text-lg font-bold text-pink-400 mb-4 flex items-center gap-2"><I.Flask/> SIMULATEUR DE BLEND</h3>
                    <div className="grid grid-cols-2 gap-6">
                        <div>
                            <div className="flex gap-2 mb-4">
                                <button onClick={()=>setZone('CITY')} className={`flex-1 py-2 rounded text-sm font-bold ${zone==='CITY'?'bg-pink-600':'bg-slate-700'}`}>CITY (F1)</button>
                                <button onClick={()=>setZone('BUNKER')} className={`flex-1 py-2 rounded text-sm font-bold ${zone==='BUNKER'?'bg-yellow-600':'bg-slate-700'}`}>BUNKER (Chance F4)</button>
                            </div>
                            <button onClick={runSim} className="w-full bg-pink-700 hover:bg-pink-600 font-bold py-2 rounded mb-2">OUVRIR 100 PACKS (SIM)</button>
                            <p className="text-xs text-slate-400">Simule les probabilités de drop (0.08% F4 sur Bunker).</p>
                        </div>
                        <div className="bg-slate-900 p-4 rounded text-center">
                            <div className="text-sm text-slate-400 mb-2">INVENTAIRE SIMULÉ</div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><div className="text-2xl font-bold text-white">{inv.F1}</div><div className="text-xs text-slate-500">F1 (Communs)</div></div>
                                <div><div className="text-2xl font-bold text-yellow-400">{inv.F4}</div><div className="text-xs text-slate-500">F4 (Légendaires)</div></div>
                            </div>
                        </div>
                    </div>
                </Card>
            );
        };

        // ==========================================
        // 4. APP PRINCIPALE (FUSION)
        // ==========================================
        const App = () => {
            const [tab, setTab] = useState('dashboard');
            const [user, setUser] = useState('u2d2k.c.wam');
            const [waxPrice, setWaxPrice] = useState(0.008);
            const [prices, setPrices] = useState(INITIAL_PRICES);
            
            // DONNÉES RÉELLES DU SCAN
            const [realBuildings, setRealBuildings] = useState([]);
            const [realDivisions, setRealDivisions] = useState([]);

            // CALCULS FINANCIERS (Issus du Fichier 28 mais appliqués au réel)
            const financials = useMemo(() => {
                let prodW = 0, costW = 0, rewardW = 0;
                const now = Date.now()/1000;

                // Prod Batiments
                realBuildings.forEach(b => {
                    const val = parseFloat(b.pRaw.replace(/[^0-9.]/g, '')) || 0;
                    let type = 'DOVF';
                    if(b.pRaw.includes('H')) type='DOVH'; if(b.pRaw.includes('R')) type='DOVR'; if(b.pRaw.includes('S')) type='DOVS';
                    
                    // Prod journalière estimée (valeur brute)
                    prodW += val * prices[type];
                    costW += (val * 0.1) * prices.DOVX; // Maintenance estimée
                });

                // Divisions Actives
                const activeDivs = realDivisions.filter(d => d.end_time > now);
                activeDivs.forEach(d => {
                    const z = ZONES_FULL.find(z => z.id === d.zone_id);
                    if(z) {
                        rewardW += z.win * prices.DOVX;
                        const runCost = z.entryCostDovX ? (z.entryCostDovX * prices.DOVX) : (z.usage * 4 * prices.DOVF);
                        costW += runCost;
                    }
                });

                const netW = (prodW + rewardW) - costW;
                return { prodW, costW, rewardW, netW, netUSD: netW * waxPrice };
            }, [realBuildings, realDivisions, prices, waxPrice]);

            return (
                <div className="max-w-[1600px] mx-auto p-4 min-h-screen">
                    {/* HEADER */}
                    <div className="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-slate-700 pb-4 gap-4">
                        <div className="flex items-center gap-3">
                            <div className="bg-blue-600 p-2 rounded"><I.Shield size={32}/></div>
                            <div>
                                <h1 className="text-2xl font-bold text-white tracking-wider">DoV <span className="text-blue-400">COMMANDER</span> v6.0</h1>
                                <p className="text-slate-400 text-xs">Ultimate Suite: Scanner + Manager + Simulators</p>
                            </div>
                        </div>
                        <div className="flex gap-4 bg-slate-800 p-2 rounded items-center text-sm">
                            <div><span className="text-green-400 font-bold block text-[10px]">WAX ($)</span><input type="number" value={waxPrice} onChange={e=>setWaxPrice(e.target.value)} className="w-20 bg-slate-900 border border-slate-600 rounded px-2 text-white"/></div>
                            <div><span className="text-slate-400 block text-[10px]">JOUEUR</span><input value={user} onChange={e=>setUser(e.target.value)} className="w-32 bg-slate-900 border border-slate-600 rounded px-2 text-white"/></div>
                        </div>
                    </div>

                    {/* NAV TABS */}
                    <div className="flex gap-2 mb-6 overflow-x-auto">
                        <button onClick={()=>setTab('dashboard')} className={`px-4 py-2 rounded font-bold flex items-center gap-2 ${tab==='dashboard'?'bg-purple-600 text-white':'bg-slate-800 text-slate-400'}`}><I.Radar/> SCANNER LIVE</button>
                        <button onClick={()=>setTab('manager')} className={`px-4 py-2 rounded font-bold flex items-center gap-2 ${tab==='manager'?'bg-blue-600 text-white':'bg-slate-800 text-slate-400'}`}><I.Factory/> MANAGER PRO</button>
                        <button onClick={()=>setTab('combat')} className={`px-4 py-2 rounded font-bold flex items-center gap-2 ${tab==='combat'?'bg-emerald-600 text-white':'bg-slate-800 text-slate-400'}`}><I.Crosshair/> COMBAT</button>
                        <button onClick={()=>setTab('blend')} className={`px-4 py-2 rounded font-bold flex items-center gap-2 ${tab==='blend'?'bg-pink-600 text-white':'bg-slate-800 text-slate-400'}`}><I.Flask/> BLEND SIM</button>
                        <button onClick={()=>setTab('valuation')} className={`px-4 py-2 rounded font-bold flex items-center gap-2 ${tab==='valuation'?'bg-cyan-600 text-white':'bg-slate-800 text-slate-400'}`}><I.Scale/> VALORISATION</button>
                    </div>

                    {/* TAB: DASHBOARD (SCANNER) */}
                    {tab === 'dashboard' && (
                        <div className="animate-fade-in">
                            <LiveScanner user={user} onUpdate={(b, d) => { setRealBuildings(b); setRealDivisions(d); }} />
                            
                            {/* WALLET PREVIEW */}
                            {realBuildings.length > 0 && (
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                                    <div className="bg-slate-900 p-4 rounded border border-slate-700">
                                        <div className="text-xs text-slate-400 mb-1">FLUX NET / JOUR</div>
                                        <div className={`text-2xl font-mono font-bold ${financials.netW>0?'text-emerald-400':'text-red-400'}`}>{financials.netW>0?'+':''}{financials.netW.toFixed(2)} WAX</div>
                                        <div className="text-xs text-slate-500">${financials.netUSD.toFixed(2)}</div>
                                    </div>
                                    <div className="bg-slate-900 p-4 rounded border border-slate-700">
                                        <div className="text-xs text-slate-400 mb-1">USINES (PROD)</div>
                                        <div className="text-xl font-mono font-bold text-white">{realBuildings.length}</div>
                                        <div className="text-xs text-slate-500">dont {realBuildings.filter(b=>b.isReady).length} à claim</div>
                                    </div>
                                    <div className="bg-slate-900 p-4 rounded border border-slate-700">
                                        <div className="text-xs text-slate-400 mb-1">DIVISIONS (ACTIVES)</div>
                                        <div className="text-xl font-mono font-bold text-orange-400">{realDivisions.filter(d=>d.end_time > Date.now()/1000).length}</div>
                                        <div className="text-xs text-slate-500">sur {realDivisions.length} totales</div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {/* TAB: MANAGER (ROI DETAIL) */}
                    {tab === 'manager' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 animate-fade-in">
                            <Card>
                                <h3 className="text-lg font-bold text-blue-400 mb-4">Analyse Financière</h3>
                                <div className="space-y-4 text-sm">
                                    <div className="flex justify-between border-b border-slate-700 pb-2"><span>Revenus Usines</span><span className="text-emerald-400">+{financials.prodW.toFixed(2)} W</span></div>
                                    <div className="flex justify-between border-b border-slate-700 pb-2"><span>Revenus Combats</span><span className="text-emerald-400">+{financials.rewardW.toFixed(2)} W</span></div>
                                    <div className="flex justify-between border-b border-slate-700 pb-2"><span>Coûts (Maint + Entrée)</span><span className="text-red-400">-{financials.costW.toFixed(2)} W</span></div>
                                    <div className="bg-slate-900 p-3 rounded text-center mt-4">
                                        <div className="text-xs text-slate-400">PROFIT NET MENSUEL (ESTIMÉ)</div>
                                        <div className="text-2xl font-bold text-white">{(financials.netW * 30).toLocaleString()} WAX</div>
                                        <div className="text-sm text-emerald-500">${(financials.netUSD * 30).toLocaleString()}</div>
                                    </div>
                                </div>
                            </Card>
                            <Card>
                                <h3 className="text-lg font-bold text-orange-400 mb-4">Base de Données (Référence)</h3>
                                <div className="h-64 overflow-y-auto pr-2 space-y-2">
                                    {FACTORIES.slice(0, 10).map((f, i) => (
                                        <div key={i} className="flex justify-between text-xs bg-slate-900 p-2 rounded">
                                            <span>{f.name}</span><span className="text-slate-400">Prod: {f.output}</span>
                                        </div>
                                    ))}
                                    <div className="text-center text-xs text-slate-500 italic">... et {FACTORIES.length - 10} autres références chargées.</div>
                                </div>
                            </Card>
                        </div>
                    )}

                    {/* TAB: COMBAT */}
                    {tab === 'combat' && (
                        <div className="animate-fade-in">
                            <Card>
                                <h3 className="text-lg font-bold text-emerald-400 mb-4 flex items-center gap-2"><I.Shield/> Préparation Tactique</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label className="text-xs text-slate-400 block mb-2">SÉLECTIONNER ZONE CIBLE</label>
                                        <select className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white">
                                            {ZONES_FULL.map(z => <option key={z.id} value={z.id}>{z.name} (Win: {z.win})</option>)}
                                        </select>
                                    </div>
                                    <div className="bg-slate-900 p-4 rounded text-center text-slate-500 text-sm italic">
                                        Sélectionnez une zone pour voir les prérequis (Clés, Officiers, Godmothers) issus de la base de données.
                                    </div>
                                </div>
                            </Card>
                        </div>
                    )}

                    {/* TAB: BLEND */}
                    {tab === 'blend' && <BlendSim prices={prices} waxPrice={waxPrice}/>}

                    {/* TAB: VALUATION */}
                    {tab === 'valuation' && (
                        <Card className="animate-fade-in border-t-4 border-cyan-500">
                            <h3 className="text-lg font-bold text-cyan-400 mb-4"><I.Scale/> Fair Value (Valeur Juste)</h3>
                            <div className="text-sm text-slate-300">
                                <p className="mb-4">Calcul basé sur le rendement de vos {realBuildings.length} bâtiments scannés.</p>
                                <div className="bg-slate-900 p-4 rounded flex justify-between items-center">
                                    <span>Valeur théorique du compte (Basée sur ROI 30j)</span>
                                    <span className="text-xl font-bold text-white">{(financials.netW * 30).toLocaleString()} WAX</span>
                                </div>
                            </div>
                        </Card>
                    )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
